# SEO Results Viewer

In-CRM viewer for SEO outputs generated by the SEO Pro Pack builders (crawl, audit, cluster).

## Features

- **File Browser**: Lists all SEO result files from `server/logs/seo/`
- **Preview**: View JSON and CSV files directly in the browser
- **Stats**: Quick file statistics (item counts, row counts)
- **Download**: Download any result file for offline analysis
- **CLI Access**: Query results via `geo seo results` command

## Usage

### Web UI

Navigate to **SEO Results** in the CRM sidebar or visit `/seo/results`.

**File Browser (Left Panel)**:
- Lists all files matching pattern: `(crawl|audit|clusters)-*.{json,csv}`
- Click any file to preview

**Preview Panel (Right Panel)**:
- JSON: Pretty-printed with syntax highlighting
- CSV: Table view (first 20 rows)
- Stats: Type, item count, row count
- Download button to save file locally

### CLI

```bash
# List all SEO result files
geo seo results

# List with custom base URL
geo seo results --base-url https://my-crm.vercel.app
```

**Output**:
```
Fetching SEO results from http://localhost:3000
âœ“ Found 3 SEO result files:
  - crawl-1234567890.json
  - audit-1234567891.json
  - clusters-1234567892.csv
```

## File Types

### Crawl Results (`crawl-*.json`)
Generated by `seo-sitemap-crawler` builder.

**Format**:
```json
[
  { "url": "https://example.com/page", "ok": true },
  { "url": "https://example.com/about", "ok": true }
]
```

### Audit Results (`audit-*.json`, `audit-*.csv`)
Generated by `seo-site-audit-lite` builder.

**JSON Format**:
```json
[
  {
    "url": "https://example.com",
    "status": 200,
    "title": "Home Page",
    "description": "Welcome...",
    "h1": "Welcome"
  }
]
```

**CSV Format**:
```
url,status,title,description,h1
https://example.com,200,Home Page,Welcome...,Welcome
```

### Cluster Results (`clusters-*.csv`)
Generated by `seo-keyword-cluster-lite` builder.

**Format**:
```
cluster,keyword_count,keywords
"seo tools",5,"seo tools | best seo tools | free seo tools | ..."
"keyword research",3,"keyword research | keyword tool | ..."
```

## Architecture

### Components

1. **File Utilities** (`web-app/lib/files.ts`)
   - `ensureSeoDir()`: Creates `server/logs/seo/` if missing
   - `listSeoFiles()`: Returns sorted array of result files
   - `readSeoFile(name)`: Reads file content with safety checks

2. **API Endpoint** (`web-app/app/api/seo/results/route.ts`)
   - `GET /api/seo/results`: List all files
   - `GET /api/seo/results?file=<name>`: Fetch file content + stats
   - Runtime: `nodejs`, Dynamic: `force-dynamic`

3. **UI Page** (`web-app/app/seo/results/page.tsx`)
   - Client-side React component
   - File browser + preview panels
   - Download handler with blob creation

4. **CLI Command** (`tools/geo-cli/src/index.ts`)
   - `geo seo results`: Calls `/api/seo/results` and formats output

### Security

- **Path Validation**: Uses `basename()` to prevent directory traversal
- **File Filtering**: Only reads files matching `(crawl|audit|clusters)-\d+\.(json|csv)$`
- **Directory Isolation**: All reads scoped to `server/logs/seo/`

## Related Docs

- [SEO_PRO_PACK.md](./SEO_PRO_PACK.md) - SEO builders and blueprint
- Builder: `seo-sitemap-crawler` - Generates crawl-*.json
- Builder: `seo-site-audit-lite` - Generates audit-*.{json,csv}
- Builder: `seo-keyword-cluster-lite` - Generates clusters-*.csv

## Troubleshooting

**No files showing up?**
- Run an SEO builder first to generate outputs
- Check `server/logs/seo/` directory exists
- Verify file names match pattern: `(crawl|audit|clusters)-*.{json,csv}`

**Preview not working?**
- Check browser console for errors
- Verify file is valid JSON/CSV
- Try downloading and opening locally

**CLI returning no results?**
- Ensure CRM is running (`npm run dev` in web-app/)
- Check `--base-url` points to correct server
- Run `geo status` to verify endpoints are up
