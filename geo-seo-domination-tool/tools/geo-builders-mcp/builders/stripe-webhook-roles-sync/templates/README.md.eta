# Builder: stripe-webhook-roles-sync

Sets up a webhook route that flips `profiles.role` between `pro` and `free` based on subscription status.

**Env required (server-side):**
- `STRIPE_SECRET_KEY`
- `STRIPE_WEBHOOK_SECRET`
- `SUPABASE_URL`
- `SUPABASE_SERVICE_ROLE` (⚠️ service key — keep server-only)

**Local test:**
```
stripe listen --forward-to localhost:3000/api/webhooks/<%= WEBHOOK_SEGMENT || 'stripe-sync' %>
```
Then trigger:
```
stripe trigger checkout.session.completed
```
